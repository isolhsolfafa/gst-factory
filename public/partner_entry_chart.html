
    <!DOCTYPE html>
    <html lang="ko">
    <head>
      <meta charset="UTF-8">
      <title>í˜‘ë ¥ì‚¬ ì¶œì… ëŒ€ì‹œë³´ë“œ</title>
      <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
      <style>
        .company-table { display: none; margin-top: 30px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background-color: #f0f0f0; }
        button { margin: 10px; padding: 8px 16px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
      </style>
    </head>
    <body>
    <div id="bar-chart" style="width: 100%; height: 400px;"></div>
    
        <div id="C&A-table" class="company-table" style="display:none;">
            <h3>C&A ê·¼ë¬´ì ëª©ë¡</h3>
            <button onclick="downloadCSV('C&A')">CSV ë‹¤ìš´ë¡œë“œ</button>
            <table border="1" style="width:500px;"><tr><th>ì´ë¦„</th><th>ë‹´ë‹¹ ì—…ë¬´</th><th>ê·¼ë¬´ì‹œê°„</th><th>ì¶œê·¼ ì‹œê°„</th><th>í‡´ê·¼ ì‹œê°„</th></tr>
            <tr><td>ê¹€íƒœê³¤</td><td>ë³¸ì‚¬</td><td>2025. 6. 20 7:55:37 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 7:55:37</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ë¼ê²½ìˆ™</td><td>ë³¸ì‚¬CHI_2</td><td>2025. 6. 20 8:03:20 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 8:03:20</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ë°•ì€í˜œ</td><td>ë³¸ì‚¬</td><td>2025. 6. 20 8:00:22 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 8:00:22</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ë°•ì¤€ì„±</td><td>ë³¸ì‚¬CHI_2</td><td>2025. 6. 20 8:07:16 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 8:07:16</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ì´ìˆ™ì</td><td>ë³¸ì‚¬</td><td>2025. 6. 20 7:59:38 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 7:59:38</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ì´ì˜ì°¬</td><td>ë³¸ì‚¬CHI_2</td><td>2025. 6. 20 8:01:46 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 8:01:46</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ì´ìš°ì„±</td><td>ë³¸ì‚¬</td><td>2025. 6. 20 7:56:33 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 7:56:33</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ì´íƒœí¬</td><td>ë³¸ì‚¬CHI_1</td><td>2025. 6. 20 7:58:03 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 7:58:03</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ì„ì˜ëŒ€</td><td>ë³¸ì‚¬CHI_2</td><td>2025. 6. 20 8:07:19 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 8:07:19</td><td>ë¯¸ì²´í¬</td></tr><tr><td>í•œìƒì¤€</td><td>ë³¸ì‚¬CHI_2</td><td>2025. 6. 20 8:01:34 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 8:01:34</td><td>ë¯¸ì²´í¬</td></tr><tr><td>í•œìƒí˜¸</td><td>ë³¸ì‚¬CHI_1</td><td>2025. 6. 20 7:58:19 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 7:58:19</td><td>ë¯¸ì²´í¬</td></tr><tr><td>í™ìˆ˜í¬</td><td>ë³¸ì‚¬</td><td>2025. 6. 20 7:58:34 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 7:58:34</td><td>ë¯¸ì²´í¬</td></tr>
            </table>
        </div>
        
        <div id="P&S-table" class="company-table" style="display:none;">
            <h3>P&S ê·¼ë¬´ì ëª©ë¡</h3>
            <button onclick="downloadCSV('P&S')">CSV ë‹¤ìš´ë¡œë“œ</button>
            <table border="1" style="width:500px;"><tr><th>ì´ë¦„</th><th>ë‹´ë‹¹ ì—…ë¬´</th><th>ê·¼ë¬´ì‹œê°„</th><th>ì¶œê·¼ ì‹œê°„</th><th>í‡´ê·¼ ì‹œê°„</th></tr>
            <tr><td>ê¹€í™ë§¤</td><td>ë³¸ì‚¬</td><td>2025. 6. 20 8:08:39 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 8:08:39</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ë‚¨ë¯¼ìˆ˜</td><td>í˜„ì¥</td><td>2025. 6. 20 8:09:46 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 8:09:46</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ë°•ê´‘ì§„</td><td>í˜„ì¥</td><td>2025. 6. 20 8:10:03 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 8:10:03</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ì´ìš´</td><td>í˜„ì¥</td><td>2025. 6. 20 8:08:43 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 8:08:43</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ì¡°í™ì—°</td><td>ë³¸ì‚¬</td><td>2025. 6. 20 8:25:23 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 8:25:23</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ìµœìœ¤ì² </td><td>í˜„ì¥</td><td>2025. 6. 20 8:19:49 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 8:19:49</td><td>ë¯¸ì²´í¬</td></tr>
            </table>
        </div>
        
        <div id="TMS(E)-table" class="company-table" style="display:none;">
            <h3>TMS(E) ê·¼ë¬´ì ëª©ë¡</h3>
            <button onclick="downloadCSV('TMS(E)')">CSV ë‹¤ìš´ë¡œë“œ</button>
            <table border="1" style="width:500px;"><tr><th>ì´ë¦„</th><th>ë‹´ë‹¹ ì—…ë¬´</th><th>ê·¼ë¬´ì‹œê°„</th><th>ì¶œê·¼ ì‹œê°„</th><th>í‡´ê·¼ ì‹œê°„</th></tr>
            <tr><td>ì˜¤ì„¸í›ˆ</td><td>ë³¸ì‚¬</td><td>2025. 6. 20 7:54:07 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 7:54:07</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ì´íš¨ì£¼</td><td>ë³¸ì‚¬</td><td>2025. 6. 20 10:06:41 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 10:06:41</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ì „ì¤€ë£¡</td><td>ë³¸ì‚¬</td><td>2025. 6. 20 8:02:31 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 8:02:31</td><td>ë¯¸ì²´í¬</td></tr><tr><td>ìµœì„ í¬</td><td>ë³¸ì‚¬</td><td>2025. 6. 20 7:54:22 (í‡´ê·¼ ë¯¸ì²´í¬)</td><td>2025. 6. 20 7:54:22</td><td>ë¯¸ì²´í¬</td></tr>
            </table>
        </div>
        
    <script>
      var companies = ["C&A", "P&S", "TMS(E)"];
      var siteCounts = [0, 4, 0];
      var hqCounts = [5, 2, 4];
      var hqChi1Counts = [2, 0, 0];
      var hqChi2Counts = [5, 0, 0];
      var siteChiCounts = [0, 0, 0];
      var barColors = ["#1f77b4", "#ff7f0e", "#2ca02c"];
      var hqBarColors = ["#1f77b480", "#ff7f0e80", "#2ca02c80"];
      var hqChi1BarColors = ["#1f77b460", "#ff7f0e60", "#2ca02c60"];
      var hqChi2BarColors = ["#1f77b450", "#ff7f0e50", "#2ca02c50"];
      var siteChiBarColors = ["#1f77b440", "#ff7f0e40", "#2ca02c40"];
      var tooltipMiss = ["\ud1f4\uadfc \ubbf8\uccb4\ud06c: \uae40\ud0dc\uace4, \ub77c\uacbd\uc219, \ubc15\uc740\ud61c, \ubc15\uc900\uc131, \uc774\uc219\uc790, \uc774\uc601\ucc2c, \uc774\uc6b0\uc131, \uc774\ud0dc\ud76c, \uc784\uc601\ub300, \ud55c\uc0c1\uc900, \ud55c\uc0c1\ud638, \ud64d\uc218\ud76c", "\ud1f4\uadfc \ubbf8\uccb4\ud06c: \uae40\ud64d\ub9e4, \ub0a8\ubbfc\uc218, \ubc15\uad11\uc9c4, \uc774\uc6b4, \uc870\ud64d\uc5f0, \ucd5c\uc724\ucca0", "\ud1f4\uadfc \ubbf8\uccb4\ud06c: \uc624\uc138\ud6c8, \uc774\ud6a8\uc8fc, \uc804\uc900\ub8e1, \ucd5c\uc120\ud76c"];
      var tooltipHq = ["\ubcf8\uc0ac \uc778\uc6d0: 5, \ubcf8\uc0acCHI_1 \uc778\uc6d0: 2, \ubcf8\uc0acCHI_2 \uc778\uc6d0: 5, \ud604\uc7a5CHI \uc778\uc6d0: 0, \ud604\uc7a5 \uc778\uc6d0: 0", "\ubcf8\uc0ac \uc778\uc6d0: 2, \ubcf8\uc0acCHI_1 \uc778\uc6d0: 0, \ubcf8\uc0acCHI_2 \uc778\uc6d0: 0, \ud604\uc7a5CHI \uc778\uc6d0: 0, \ud604\uc7a5 \uc778\uc6d0: 4", "\ubcf8\uc0ac \uc778\uc6d0: 4, \ubcf8\uc0acCHI_1 \uc778\uc6d0: 0, \ubcf8\uc0acCHI_2 \uc778\uc6d0: 0, \ud604\uc7a5CHI \uc778\uc6d0: 0, \ud604\uc7a5 \uc778\uc6d0: 0"];
      var weekNumber = 25

      var data = [
        {
          x: companies,
          y: siteCounts,
          name: 'í˜„ì¥ ì¸ì›',
          type: 'bar',
          text: siteCounts,
          textposition: 'inside',
          marker: {color: barColors},
          hovertext: tooltipMiss,
          hoverinfo: 'text+y+name',
          customdata: companies
        },
        {
          x: companies,
          y: hqCounts,
          name: 'ë³¸ì‚¬ ì¸ì›',
          type: 'bar',
          text: hqCounts,
          textposition: 'inside',
          marker: {color: hqBarColors},
          hovertext: tooltipHq,
          hoverinfo: 'text+y+name',
          customdata: companies
        },
        {
          x: companies,
          y: hqChi1Counts,
          name: 'ë³¸ì‚¬CHI_1 ì¸ì›',
          type: 'bar',
          text: hqChi1Counts,
          textposition: 'inside',
          marker: {color: hqChi1BarColors},
          hovertext: tooltipHq,
          hoverinfo: 'text+y+name',
          customdata: companies
        },
        {
          x: companies,
          y: hqChi2Counts,
          name: 'ë³¸ì‚¬CHI_2 ì¸ì›',
          type: 'bar',
          text: hqChi2Counts,
          textposition: 'inside',
          marker: {color: hqChi2BarColors},
          hovertext: tooltipHq,
          hoverinfo: 'text+y+name',
          customdata: companies
        },
        {
          x: companies,
          y: siteChiCounts,
          name: 'í˜„ì¥CHI ì¸ì›',
          type: 'bar',
          text: siteChiCounts,
          textposition: 'inside',
          marker: {color: siteChiBarColors},
          hovertext: tooltipHq,
          hoverinfo: 'text+y+name',
          customdata: companies
        }
      ];
      var layout = {
        title: 'ğŸ­í˜‘ë ¥ì‚¬ë³„ ì¶œì… ì¸ì› ìˆ˜',
        barmode: 'stack',
        hovermode: 'closest',
        showlegend: true
      };
      var config = {
        displayModeBar: false,
        scrollZoom: false,
        staticPlot: false
      };
      Plotly.newPlot('bar-chart', data, layout, config);

      var lastOpened = null;
      document.getElementById('bar-chart').on('plotly_click', function(data) {
        var company = data.points[0].customdata;
        var target = document.getElementById(company + "-table");
        if (lastOpened === company) {
          target.style.display = "none";
          lastOpened = null;
        } else {
          document.querySelectorAll(".company-table").forEach(div => div.style.display = "none");
          target.style.display = "block";
          target.scrollIntoView({ behavior: "smooth" });
          lastOpened = company;
        }
      });

      function downloadCSV(company) {
        try {
          var compTable = document.getElementById(company + "-table");
          var rows = compTable.querySelectorAll("table tr");
          var csvContent = "ï»¿";
          csvContent += "ì´ë¦„,ë‹´ë‹¹ ì—…ë¬´,ê·¼ë¬´ì‹œê°„,ì¶œê·¼ ì‹œê°„,í‡´ê·¼ ì‹œê°„\n"; // í—¤ë”ì— ì¶œí‡´ê·¼ ì‹œê°„ ì¶”ê°€
          for (var i = 1; i < rows.length; i++) {
            var cells = rows[i].querySelectorAll("td");
            var rowData = [
              '"' + cells[0].innerText.replace(/"/g, '""') + '"',
              '"' + cells[1].innerText.replace(/"/g, '""') + '"',
              '"' + cells[2].innerText.replace(/"/g, '""') + '"',
              '"' + cells[3].innerText.replace(/"/g, '""') + '"', // ì¶œê·¼ ì‹œê°„
              '"' + cells[4].innerText.replace(/"/g, '""') + '"'   // í‡´ê·¼ ì‹œê°„
            ];
            csvContent += rowData.join(",") + "\n";
          }

          var weekData = [];
          fetch(`/weekly_data/${company}_week_${weekNumber}.json`)
            .then(response => response.json())
            .then(data => {
              weekData = data;
              csvContent += "\nì£¼ê°„ ë°ì´í„°:\n";
              csvContent += "ì´ë¦„,ë‹´ë‹¹ ì—…ë¬´,ì¶œê·¼ ì‹œê°„,í‡´ê·¼ ì‹œê°„,ê·¼ë¬´ì‹œê°„,í‡´ê·¼ë¯¸ì²´í¬\n";
              weekData.forEach(item => {
                var rowData = [
                  '"' + (item["ì´ë¦„"] || "").replace(/"/g, '""') + '"',
                  '"' + (item["ë‹´ë‹¹ ì—…ë¬´"] || "").replace(/"/g, '""') + '"',
                  '"' + (item["ì¶œê·¼ ì‹œê°„"] || "").replace(/"/g, '""') + '"',
                  '"' + (item["í‡´ê·¼ ì‹œê°„"] || "").replace(/"/g, '""') + '"',
                  '"' + (item["ê·¼ë¬´ì‹œê°„(H:M)"] || "").replace(/"/g, '""') + '"',
                  '"' + (item["í‡´ê·¼ë¯¸ì²´í¬"] ? "ì˜ˆ" : "ì•„ë‹ˆì˜¤") + '"'
                ];
                csvContent += rowData.join(",") + "\n";
              });

              var today = new Date();
              var dateStr = today.getFullYear() + String(today.getMonth() + 1).padStart(2, '0') + String(today.getDate()).padStart(2, '0');
              var fileName = `${company}_entry_list_${dateStr}.csv`;
              var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
              var url = window.URL.createObjectURL(blob);
              var link = document.createElement('a');
              link.setAttribute('href', url);
              link.setAttribute('download', fileName);
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
              window.URL.revokeObjectURL(url);
            })
            .catch(error => {
              console.error("Error fetching weekly data:", error);
              alert("ì£¼ê°„ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¹ì¼ ë°ì´í„°ë§Œ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.");
              var today = new Date();
              var dateStr = today.getFullYear() + String(today.getMonth() + 1).padStart(2, '0') + String(today.getDate()).padStart(2, '0');
              var fileName = `${company}_entry_list_${dateStr}.csv`;
              var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
              var url = window.URL.createObjectURL(blob);
              var link = document.createElement('a');
              link.setAttribute('href', url);
              link.setAttribute('download', fileName);
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
              window.URL.revokeObjectURL(url);
            });
        } catch (error) {
          console.error("CSV download error:", error);
          alert("CSV ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }
    </script>
    </body>
    </html>
    