
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>í˜‘ë ¥ì‚¬ ì¶œì… í˜„í™© (ì¼ìë³„ ê´€ë¦¬)</title>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <style>
            body { font-family: 'Malgun Gothic', sans-serif; margin: 20px; background-color: #f5f5f5; }
            .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
            h1 { color: #2c3e50; text-align: center; margin-bottom: 30px; }
            .summary { background: #ecf0f1; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
            .chart-container { margin: 20px 0; }
            .company-section { margin-bottom: 30px; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; }
            .company-header { background: #3498db; color: white; padding: 15px; cursor: pointer; }
            .company-content { display: none; padding: 20px; }
            .company-content.active { display: block; }
            table { width: 100%; border-collapse: collapse; margin-top: 10px; }
            th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
            th { background-color: #f8f9fa; font-weight: bold; }
            .download-btn { background: #27ae60; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
            .download-btn:hover { background: #229954; }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ğŸ¢ í˜‘ë ¥ì‚¬ ì¶œì… í˜„í™© (ì¼ìë³„ ê´€ë¦¬)</h1>
            <div class="summary">
                <strong>ğŸ“Š ìš”ì•½:</strong> ì´ 2ê°œ íšŒì‚¬, 21ëª… ì¶œì…
                <br><strong>ğŸ“… ìƒì„±ì¼ì‹œ:</strong> 2025ë…„ 06ì›” 25ì¼ 01ì‹œ 00ë¶„
                <br><strong>ğŸ”„ ê´€ë¦¬ë°©ì‹:</strong> ì¼ìë³„ ë…ë¦½ ê´€ë¦¬ (ë°ì´í„° ì•ˆì „ì„± í–¥ìƒ)
            </div>
            
            <div class="chart-container">
                <div id="bar-chart" style="width: 100%; height: 400px;"></div>
            </div>
    
            <div class="company-section">
                <div class="company-header" onclick="toggleCompany('company_0')">
                    <h3>ğŸ­ BAT (ì´ 20ëª…: ë³¸ì‚¬ 0ëª…, í˜„ì¥ 20ëª…)</h3>
                </div>
                <div class="company-content" id="company_0">
                    <button class="download-btn" onclick="downloadDailyCSV('BAT')">ğŸ“¥ ì¼ìë³„ CSV ë‹¤ìš´ë¡œë“œ</button>
                    <table id="table_BAT">
                        <thead>
                            <tr>
                                <th>ì´ë¦„</th>
                                <th>ë‹´ë‹¹ ì—…ë¬´</th>
                                <th>ì¶œê·¼ ì‹œê°„</th>
                                <th>í‡´ê·¼ ì‹œê°„</th>
                                <th>ê·¼ë¬´ì‹œê°„</th>
                                <th>í‡´ê·¼ë¯¸ì²´í¬</th>
                            </tr>
                        </thead>
                        <tbody>
        
                            <tr>
                                <td>ê°„ì—°ì›…</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ê¹€êµ°</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ê¹€ì›ë™</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ê¹€ì¶˜ë™</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ë°•ì¢…ë²”</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ë°•í˜¸</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ë°°í™ë²”</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ìš°ë¯¸ì •</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ìš°ë¯¸í˜„</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ìœ¤ì²­ìš©</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ì „ì„±í™˜</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ì •ëŒ€í•œ</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ì •ì¸ê·œ</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ì¡°ë™ë˜</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ì±„ì€ì² </td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>ìµœì§„ìš°</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>í—ˆìš©ê¸¸</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>í—ˆì°½í•™</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>í™ì‚¬í˜„</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                            <tr>
                                <td>í™©í˜¸</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                        </tbody>
                    </table>
                </div>
            </div>
        
            <div class="company-section">
                <div class="company-header" onclick="toggleCompany('company_1')">
                    <h3>ğŸ­ TEST (ì´ 1ëª…: ë³¸ì‚¬ 0ëª…, í˜„ì¥ 1ëª…)</h3>
                </div>
                <div class="company-content" id="company_1">
                    <button class="download-btn" onclick="downloadDailyCSV('TEST')">ğŸ“¥ ì¼ìë³„ CSV ë‹¤ìš´ë¡œë“œ</button>
                    <table id="table_TEST">
                        <thead>
                            <tr>
                                <th>ì´ë¦„</th>
                                <th>ë‹´ë‹¹ ì—…ë¬´</th>
                                <th>ì¶œê·¼ ì‹œê°„</th>
                                <th>í‡´ê·¼ ì‹œê°„</th>
                                <th>ê·¼ë¬´ì‹œê°„</th>
                                <th>í‡´ê·¼ë¯¸ì²´í¬</th>
                            </tr>
                        </thead>
                        <tbody>
        
                            <tr>
                                <td>ê¹€ë™ê·œ</td>
                                <td>í˜„ì¥</td>
                                <td>2025. 6. 25 0:27:40</td>
                                <td></td>
                                <td>0ì‹œê°„ 0ë¶„</td>
                                <td>ì˜ˆ</td>
                            </tr>
            
                        </tbody>
                    </table>
                </div>
            </div>
        
        </div>

        <script>
            // ë§‰ëŒ€ê·¸ë˜í”„ ë°ì´í„°
            var companies = ["BAT", "TEST"];
            var totalCounts = [20, 1];
            var hqCounts = [0, 0];
            var siteCounts = [20, 1];
            var barColors = ["#1f77b4", "#ff7f0e"];
            var hqBarColors = ["#1f77b480", "#ff7f0e80"];
            var tooltipMiss = ["\ud1f4\uadfc \ubbf8\uccb4\ud06c: \uac04\uc5f0\uc6c5, \uae40\uad70, \uae40\uc6d0\ub3d9, \uae40\ucd98\ub3d9, \ubc15\uc885\ubc94, \ubc15\ud638, \ubc30\ud64d\ubc94, \uc6b0\ubbf8\uc815, \uc6b0\ubbf8\ud604, \uc724\uccad\uc6a9, \uc804\uc131\ud658, \uc815\ub300\ud55c, \uc815\uc778\uaddc, \uc870\ub3d9\ub798, \ucc44\uc740\ucca0, \ucd5c\uc9c4\uc6b0, \ud5c8\uc6a9\uae38, \ud5c8\ucc3d\ud559, \ud64d\uc0ac\ud604, \ud669\ud638", "\ud1f4\uadfc \ubbf8\uccb4\ud06c: \uae40\ub3d9\uaddc"];
            var tooltipHq = ["\ubcf8\uc0ac: 0\uba85, \ud604\uc7a5: 20\uba85", "\ubcf8\uc0ac: 0\uba85, \ud604\uc7a5: 1\uba85"];

            // ë§‰ëŒ€ê·¸ë˜í”„ ìƒì„±
            var trace1 = {
                x: companies,
                y: totalCounts,
                type: 'bar',
                name: 'ì´ ì¸ì›',
                marker: { color: barColors },
                text: totalCounts.map((val, idx) => 
                    val + 'ëª…<br>' + (tooltipMiss[idx] || '') + '<br>' + (tooltipHq[idx] || '')),
                textposition: 'auto',
                hovertemplate: '%{x}<br>ì´ ì¸ì›: %{y}ëª…<br>%{text}<extra></extra>'
            };

            var trace2 = {
                x: companies,
                y: hqCounts,
                type: 'bar',
                name: 'ë³¸ì‚¬ ì¸ì›',
                marker: { color: hqBarColors },
                text: hqCounts.map(val => val + 'ëª…'),
                textposition: 'auto',
                hovertemplate: '%{x}<br>ë³¸ì‚¬ ì¸ì›: %{y}ëª…<extra></extra>'
            };

            var data = [trace1, trace2];
            var layout = {
                title: 'íšŒì‚¬ë³„ ì¶œì… í˜„í™© (ì¼ìë³„)',
                xaxis: { title: 'íšŒì‚¬ëª…' },
                yaxis: { title: 'ì¸ì› ìˆ˜' },
                barmode: 'group',
                font: { family: 'Malgun Gothic, sans-serif' },
                margin: { l: 50, r: 50, t: 50, b: 100 }
            };

            Plotly.newPlot('bar-chart', data, layout);

            function toggleCompany(companyId) {
                var content = document.getElementById(companyId);
                content.classList.toggle('active');
            }

            function downloadDailyCSV(company) {
                try {
                    var today = new Date();
                    var dateStr = today.getFullYear() + '_' + 
                                 String(today.getMonth() + 1).padStart(2, '0') + '_' + 
                                 String(today.getDate()).padStart(2, '0');
                    
                    // ì¼ìë³„ JSON íŒŒì¼ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    fetch(`/daily_data/${company}_${dateStr}.json`)
                        .then(response => response.json())
                        .then(dailyData => {
                            // CSV í—¤ë”
                            var csvContent = "\ufeff";
                            csvContent += "ì´ë¦„,ë‹´ë‹¹ ì—…ë¬´,ì¶œê·¼ ì‹œê°„,í‡´ê·¼ ì‹œê°„,ê·¼ë¬´ì‹œê°„,í‡´ê·¼ë¯¸ì²´í¬\n";
                            
                            // ì¼ìë³„ ë°ì´í„° ì •ë ¬
                            dailyData.sort(function(a, b) {
                                return (a["ì´ë¦„"] || "").localeCompare(b["ì´ë¦„"] || "", 'ko-KR');
                            });
                            
                            // CSV ë°ì´í„° ìƒì„±
                            dailyData.forEach(item => {
                                var rowData = [
                                    '"' + (item["ì´ë¦„"] || "").replace(/"/g, '""') + '"',
                                    '"' + (item["ë‹´ë‹¹ ì—…ë¬´"] || "").replace(/"/g, '""') + '"',
                                    '"' + (item["ì¶œê·¼ ì‹œê°„"] || "").replace(/"/g, '""') + '"',
                                    '"' + (item["í‡´ê·¼ ì‹œê°„"] || "").replace(/"/g, '""') + '"',
                                    '"' + (item["ê·¼ë¬´ì‹œê°„(H:M)"] || "").replace(/"/g, '""') + '"',
                                    '"' + (item["í‡´ê·¼ë¯¸ì²´í¬"] ? "ì˜ˆ" : "ì•„ë‹ˆì˜¤") + '"'
                                ];
                                csvContent += rowData.join(",") + "\n";
                            });

                            // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                            var fileName = `${company}_entry_list_${dateStr}.csv`;
                            var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
                            var url = window.URL.createObjectURL(blob);
                            var link = document.createElement('a');
                            link.setAttribute('href', url);
                            link.setAttribute('download', fileName);
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            window.URL.revokeObjectURL(url);
                        })
                        .catch(error => {
                            console.error("Error fetching daily data:", error);
                            alert("ì¼ìë³„ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤: " + error);
                        });
                } catch (error) {
                    console.error("CSV download error:", error);
                    alert("CSV ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            }
        </script>
    </body>
    </html>
    